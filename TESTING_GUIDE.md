# Руководство по тестированию WebRTC звонков

## Исправленные проблемы

### 1. Проблема с состоянием звонка
- **Проблема**: Показывало "Вы уже в звонке" даже когда не было активного звонка
- **Решение**: Исправлена логика сброса состояния `isInCall` и добавлено логирование для отладки

### 2. Проблема с отсутствием звука
- **Проблема**: Аудио не передавалось между пользователями
- **Решение**: 
  - Добавлено логирование треков
  - Исправлена обработка аудио треков
  - Добавлен атрибут `controls` к удаленному видео для отладки

### 3. Проблема с видео
- **Проблема**: Видео не отображалось или работало некорректно
- **Решение**:
  - Улучшена обработка медиа потоков
  - Добавлено логирование для отладки
  - Исправлена логика определения типа звонка

## Как тестировать

### Шаг 1: Запуск сервера
```bash
npm start
```
Сервер запустится на порту 3000.

### Шаг 2: Открытие в браузере
1. Откройте `http://localhost:3000` в первом браузере/вкладке
2. Введите имя пользователя (например, "Пользователь1")
3. Создайте новую комнату или введите ID существующей

### Шаг 3: Подключение второго пользователя
1. Откройте `http://localhost:3000` во втором браузере/вкладке
2. Введите другое имя (например, "Пользователь2")
3. Введите тот же ID комнаты

### Шаг 4: Тестирование звонков
1. **Голосовой звонок**: Нажмите кнопку телефона у одного из пользователей
2. **Видеозвонок**: Нажмите кнопку видео у одного из пользователей
3. **Принятие звонка**: Второй пользователь должен увидеть модальное окно с предложением принять звонок

### Шаг 5: Проверка функций
- ✅ Звук должен работать в обе стороны
- ✅ Видео должно отображаться (для видеозвонков)
- ✅ Кнопки управления (микрофон, камера, завершение звонка) должны работать
- ✅ Состояние звонка должно корректно сбрасываться после завершения

## Отладка

### Консоль браузера
Откройте Developer Tools (F12) и проверьте консоль на наличие:
- Логов о получении треков
- Состояния WebRTC соединения
- Ошибок ICE соединения

### Проверка медиа устройств
Убедитесь, что:
- Микрофон и камера разрешены в браузере
- Нет других приложений, использующих эти устройства
- Браузер поддерживает WebRTC (Chrome, Firefox, Safari)

## Возможные проблемы

1. **Нет звука**: Проверьте разрешения микрофона в браузере
2. **Нет видео**: Проверьте разрешения камеры в браузере
3. **Не подключается**: Проверьте файрвол и сетевые настройки
4. **Ошибки ICE**: Попробуйте другой браузер или сеть

## Технические детали

- Используется STUN серверы Google для NAT traversal
- Поддержка fallback для медиа ограничений
- Автоматическое отклонение входящих звонков при активном звонке
- Корректная очистка ресурсов при завершении звонка
